# =============================================================================
# Variables de entorno para Microservicio Users - PLANTILLA
# =============================================================================
# IMPORTANTE: Este es un archivo de ejemplo. Copie este archivo a:
#   - .env.development (para entorno de desarrollo local)
#   - .env.production (para entorno de producción)
# y ajuste los valores según su entorno específico.
#
# ADVERTENCIA DE SEGURIDAD:
# - NO commitear archivos .env.development o .env.production al repositorio
# - Cambiar TODAS las contraseñas antes de usar en producción
# - Los secretos JWT deben ser únicos y seguros (mínimo 64 caracteres)
# - Usar User Secrets para desarrollo: dotnet user-secrets set "JwtSettings:SecretKey" "<key>"
# - Usar Azure Key Vault para producción
# =============================================================================

# --- ENTORNO ---
# Valores: Development, Staging, Production
ASPNETCORE_ENVIRONMENT=Development

# --- URLS DEL API ---
# URL donde el API escuchará peticiones
ASPNETCORE_URLS=http://+:8081

# --- BASE DE DATOS MYSQL ---
DB_NAME=usersdb
DB_USER=msuser
DB_PASSWORD=CHANGE_THIS_PASSWORD_IN_PRODUCTION
DB_ROOT_PASSWORD=CHANGE_THIS_ROOT_PASSWORD_IN_PRODUCTION
DB_PORT=3307

# --- PUERTO DEL API ---
# Puerto expuesto en el host para acceder al API
API_HOST_PORT=8081

# --- JWT CONFIGURATION ---
# IMPORTANTE: No exponer estos valores directamente en producción
# Usar User Secrets (desarrollo) o Azure Key Vault (producción)
# Para generar SecretKey: .\Generate-JwtSecretKey.ps1 -Type Special -Length 64

# JWT Secret Key (mínimo 64 caracteres, usar User Secrets en producción)
# JwtSettings__SecretKey=USAR_USER_SECRETS_O_AZURE_KEY_VAULT

# JWT Issuer (quién emite el token)
# Development: AccessibilityUsersAPI
# Production: https://api.yourcompany.com/users
JwtSettings__Issuer=AccessibilityUsersAPI

# JWT Audience (para quién es el token)
# Development: AccessibilityClients
# Production: https://yourcompany.com
JwtSettings__Audience=AccessibilityClients

# JWT Token expiration in hours
JwtSettings__ExpiryHours=24

# --- AUTENTICACIÓN Y SESIONES ---
# Duración de tokens de sesión en minutos (legacy)
Auth__SessionTokenMinutes=1440

# --- HEALTH CHECKS ---
# Habilitar detalles de errores en health checks
HealthChecks__EnableDetailedErrors=true

# Umbral de memoria en MB (alertar si se excede)
HealthChecks__MemoryThresholdMB=512

# --- MÉTRICAS (PROMETHEUS) ---
# Habilitar recolección de métricas
Metrics__Enabled=true

# Habilitar métricas HTTP automáticas
Metrics__EnableHttpMetrics=true

# --- LOGGING ---
# Niveles: Trace, Debug, Information, Warning, Error, Critical
Logging__LogLevel__Default=Information
Logging__LogLevel__Microsoft.AspNetCore=Warning
Logging__LogLevel__Microsoft.Extensions.Diagnostics.HealthChecks=Information

# --- HOSTS PERMITIDOS ---
# En producción, especificar dominios permitidos: "app.company.com,api.company.com"
AllowedHosts=*

# --- MYSQL OPCIONALES ---
# Configuraciones avanzadas de MySQL (descomentar si es necesario)
# MYSQL_CHARSET=utf8mb4
# MYSQL_COLLATION=utf8mb4_unicode_ci
# ENABLE_SSL=false
# CONNECTION_TIMEOUT=30
# COMMAND_TIMEOUT=300

# =============================================================================
# EJEMPLOS DE CONFIGURACIÓN POR ENTORNO
# =============================================================================

# --- DESARROLLO LOCAL ---
# ASPNETCORE_ENVIRONMENT=Development
# DB_PORT=3307
# API_HOST_PORT=8081
# JwtSettings__Issuer=AccessibilityUsersAPI
# JwtSettings__Audience=AccessibilityClients

# --- STAGING ---
# ASPNETCORE_ENVIRONMENT=Staging
# DB_PORT=3306
# API_HOST_PORT=8081
# JwtSettings__Issuer=https://api-staging.company.com/users
# JwtSettings__Audience=https://staging.company.com

# --- PRODUCCIÓN ---
# ASPNETCORE_ENVIRONMENT=Production
# DB_PORT=3306
# API_HOST_PORT=8081
# JwtSettings__Issuer=https://api.company.com/users
# JwtSettings__Audience=https://app.company.com
# AllowedHosts=api.company.com,app.company.com

# =============================================================================
# NOTAS IMPORTANTES
# =============================================================================

# 1. CONNECTION STRING:
#    Se construye automáticamente en docker-compose.yml:
#    server=mysql;port=3306;database=${DB_NAME};user=${DB_USER};password=${DB_PASSWORD}
#
#    Para desarrollo local (fuera de Docker):
#    server=localhost;port=${DB_PORT};database=${DB_NAME};user=${DB_USER};password=${DB_PASSWORD}

# 2. JWT SECRET KEY (CRÍTICO):
#    DESARROLLO:
#      cd src/Users.Api
#      dotnet user-secrets set "JwtSettings:SecretKey" "tu-clave-de-64-caracteres"
#
#    PRODUCCIÓN:
#      Usar Azure Key Vault, AWS Secrets Manager, o similar
#      NUNCA hardcodear en variables de entorno de contenedor

# 3. SINCRONIZACIÓN CON GATEWAY:
#    Los valores de JWT (Issuer, Audience, SecretKey) DEBEN coincidir con el Gateway
#    Ejecutar script de validación: .\Validate-JwtConfig.ps1

# 4. USAR CON DOCKER COMPOSE:
#    docker compose --env-file .env.development up
#    docker compose --env-file .env.production up -d

# 5. GENERAR CONTRASEÑAS SEGURAS:
#    PowerShell:
#      .\Generate-JwtSecretKey.ps1 -Type Special -Length 64
#
#    Linux/macOS:
#      openssl rand -base64 48
#
#    Online (solo para desarrollo):
#      https://generate-secret.vercel.app/64

# 6. VERIFICAR CONFIGURACIÓN:
#    .\Validate-JwtConfig.ps1

# =============================================================================
